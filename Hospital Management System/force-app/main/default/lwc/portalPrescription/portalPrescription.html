<template>
    <lightning-card title="My Prescriptions" icon-name="custom:custom14">
        <template if:true={prescriptions}>
            <lightning-accordion allow-multiple-sections-open>
                <template for:each={prescriptions} for:item="presc">
                    <lightning-accordion-section key={presc.Id} name={presc.Id} label={presc.label}>
                        <div class="slds-grid slds-gutters slds-wrap slds-p-bottom_small">
                            <div class="slds-col slds-size_1-of-2">
                                <p><strong>Date:</strong> <lightning-formatted-date-time value={presc.CreatedDate}></lightning-formatted-date-time></p>
                                <p><strong>Total Amount:</strong> <lightning-formatted-number value={presc.Total_Medication_Amount__c} format-style="currency"></lightning-formatted-number></p>
                            </div>
                            <div class="slds-col slds-size_1-of-1 slds-p-top_small">
                                <p><strong>Notes:</strong> {presc.Notes__c}</p>
                            </div>
                        </div>
                        
                        <h3 class="slds-text-heading_small slds-m-bottom_x-small">Medications</h3>
                        <template if:true={presc.hasMedications}>
                            <lightning-datatable
                                key-field="Id"
                                data={presc.Medication_Line_Items__r}
                                columns={columns}
                                hide-checkbox-column>
                            </lightning-datatable>
                        </template>
                        <template if:false={presc.hasMedications}>
                            <p class="slds-text-color_weak">No medications listed.</p>
                        </template>
                    </lightning-accordion-section>
                </template>
            </lightning-accordion>
        </template>
        <template if:false={prescriptions}>
            <div class="slds-p-around_medium">
                <p>No prescriptions found.</p>
            </div>
        </template>
    </lightning-card>
</template>